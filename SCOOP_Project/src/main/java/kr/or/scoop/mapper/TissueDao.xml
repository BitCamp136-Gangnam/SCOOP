<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.scoop.dao.TissueDao">

<resultMap type="kr.or.scoop.dto.Member" id="Member">
	<result column="tseq" property="tseq"/>
	<result column="email" property="email"/>
	<result column="name" property="name"/>
	<result column="pname" property="pname"/>
	<result column="pcontent" property="pcontent"/>
	<result column="ptime" property="ptime"/>
	<result column="istpalarm" property="istpalarm"/>
	<result column="ischarge" property="ischarge"/>
	<collection property="tissue" resultMap="Tissue"/>
	<collection property="tpmember" resultMap="Tpmember"/>
	<collection property="reply" resultMap="Reply"/>
</resultMap>
<resultMap type="kr.or.scoop.dto.Tissue" id="Tissue">
	<result column="tiseq" property="tiseq"/>
	<result column="tseq" property="tseq"/>
	<result column="email" property="email"/>
	<result column="tititle" property="tititle"/>
	<result column="ticontent" property="ticontent"/>
	<result column="tistart" property="tistart"/>
	<result column="tiend" property="tiend"/>
	<result column="isprocess" property="isprocess"/>
	<result column="isbook" property="isbook"/>
	<result column="issee" property="issee"/>
	<result column="tidate" property="tidate"/>
	<result column="tgfilename" property="tgfilename"/>
	<result column="turl" property="turl"/>
</resultMap>
<resultMap type="kr.or.scoop.dto.Reply" id="Reply">
	<result column="replyseq" property="replyseq"/>
	<result column="rcontent" property="rcontent"/>
	<result column="email" property="email"/>
	<result column="rdate" property="rdate"/>
	<result column="tiseq" property="tiseq"/>
</resultMap>
<select id="loadKanban" parameterType="int" resultMap="Tissue">
	select *
	from tissue
	where tseq = #{tseq}
</select>
<select id="teamissueDetail" resultType="kr.or.scoop.dto.Tissue">
	SELECT * FROM tissue WHERE tiseq = #{tiseq, jdbcType=INTEGER}
</select>
<update id="teamSetting">
	update tpmember set pjuserrank=#{param1} where tseq=#{param2} and email=#{param3}
</update>
<update id="kanbanEdit">
	UPDATE tissue 
	SET isprocess=#{param3}
	WHERE tiseq = #{param2} and tseq = #{param1}
</update>
<delete id="banMember">
	delete from tpmember where tseq=#{param1} and email=#{param2}
</delete>
<update id="changeMember">
	update teampjt set email = #{param2} where tseq=#{param1}
</update>
<update id="changeMemberTp">
	update tpmember set pjuserrank = 100 where email= #{param2} and tseq=#{param1}
</update>
<update id="changeMemberTp2">
	update tpmember set pjuserrank = 300 where email= #{param2} and tseq=#{param1}
</update>
<delete id="dropProject">
	delete from teampjt where tseq=#{param1}
</delete>
<!-- <update id="tiBookMark" parameterType="kr.or.scoop.dto.Tissue">
	update Tissue
	set istbook = #{param2}
	where tiseq=#{param1} and email=#{param3}
</update> -->
<!-- 북마크 -->
<insert id="addTBookMark">
	insert into bookmark(bseq, tiseq, email) 
	values(bseq_bookmark_seq.nextval, #{param1}, #{param2})
</insert>
<delete id="delTBookMark">
	delete from bookmark 
	where tiseq=#{param1} and email=#{param2}
</delete>
<insert id="teamComment">
	insert into reply(replyseq, rcontent, email, rdate, tiseq)
  	values(replyseq_reply_seq.nextval, #{param2}, #{param3}, sysdate, #{param1})
</insert>
<select id="teamCommentOk" resultType="kr.or.scoop.dto.Reply">
	select * from reply r join member m on r.email=m.email where tiseq = #{tiseq}
</select>
<insert id="fileInsert">
	insert into filedrive(fdseq, tiseq, fdcapa, fdname, email, fddate, tseq)
  	values(fdseq_filedrive_seq.nextval, (select Max(tiseq) from tissue), #{param3}, #{param2}, #{param4, jdbcType=VARCHAR}, sysdate, #{param1, jdbcType=INTEGER})
</insert>
<insert id="myFileInsert">
	insert into pfiledrive(pdseq, pdcapa, pfdname, pfddate, email, piseq)
  	values(pdseq_pfiledrive_seq.nextval, #{param2}, #{param1}, sysdate, #{param3, jdbcType=VARCHAR}, (select Max(piseq) from myissue))
</insert>
<insert id="mentionInsert">
	insert into teammention values((select Max(tiseq) from tissue),tmseq_teammention_seq.nextval, #{email, jdbcType=VARCHAR})
</insert>
<insert id="myMentionInsert">
	insert into pmention values(pmseq_pmention_seq.nextval, #{email, jdbcType=VARCHAR}, (select Max(piseq) from myissue))
</insert>
<select id="getFiles" resultType="kr.or.scoop.dto.FileDrive">
	select * from FileDrive where tiseq=#{tiseq}
</select>
<select id="getMentions" resultType="kr.or.scoop.dto.Mention">
	select * from teammention t join member m on t.tmemail=m.email where t.tiseq=#{tiseq}
</select>
<select id="getGoogleDrive" resultType="kr.or.scoop.dto.GoogleDrive">
	select * from teamgoogledrive where tiseq=#{tiseq}
</select>
<select id="getDoWork" resultType="kr.or.scoop.dto.DoWork">
	select (select m.name from teamdowork d join member m on d.email=m.email where d.tiseq=#{tiseq}) fromname, (select m.name from teamdowork d join member m on d.toemail=m.email where d.tiseq=#{tiseq}) toname, dowork from teamdowork where tiseq=#{tiseq}
</select>
<select id="chartData" resultType="kr.or.scoop.dto.Process">
	select distinct (select count(*) from tissue where tseq = #{tseq} and isprocess=0) as initiative, 
                	(select count(*) from tissue where tseq = #{tseq} and isprocess=1) as progress, 
                	(select count(*) from tissue where tseq = #{tseq} and isprocess=2) as pause, 
                	(select count(*) from tissue where tseq = #{tseq} and isprocess=3) as complete 
	from tissue 
</select>
<insert id="googleDriveInsert">
	insert into teamgoogledrive values(tgseq_teamgoogledrive_seq.nextval,#{param1}, #{param2},(select Max(tiseq) from tissue))
</insert>
<insert id="myGoogleDriveInsert">
	insert into pgoogledrive values(pgseq_pgoogledrive_seq.nextval,#{param1}, #{param2},(select Max(piseq) from myissue))
</insert>
<insert id="doWorkInsert">
	insert into teamdowork values(tdseq_teamdowork_seq.nextval, (select Max(tiseq) from tissue), #{param1}, #{param2}, #{param3})
</insert>
<insert id="myDoWorkInsert">
	insert into pdowork values(pwseq_pdowork_seq.nextval, (select Max(piseq) from myissue), #{param1}, #{param2}, #{param3})
</insert>
</mapper>