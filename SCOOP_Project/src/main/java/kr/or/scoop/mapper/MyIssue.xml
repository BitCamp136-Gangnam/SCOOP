<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.scoop.dao.MyIssueDao">
<insert id="writeTissue" parameterType="kr.or.scoop.dto.MyIssue" >
insert into tissue (tiseq,tseq,email,tititle,ticontent,isprocess, istbook, issee, tidate)
  values (TISEQ_TISSUE_SEQ.NEXTVAL, #{tseq}, #{email}, #{tititle}, #{ticontent}, 0, 0, 0, sysdate)
</insert>
<insert id="writeMyissue" parameterType="kr.or.scoop.dto.MyIssue" >
insert into myissue (piseq,pititle,picontent,pistart, piend, ispibook, email, pidate, mygfilename, mymention, myurl)
  values (PISEQ_MYISSUE_SEQ.NEXTVAL, #{pititle}, #{picontent}, #{pistart,jdbcType=DATE}, #{piend,jdbcType=DATE}, 0, #{email,jdbcType=VARCHAR}, sysdate, #{mygfilename,jdbcType=VARCHAR}, #{mymention,jdbcType=VARCHAR}, #{myurl,jdbcType=VARCHAR})
</insert>
<select id="getMyissue" resultType="kr.or.scoop.dto.MyIssue">
	SELECT piseq, pititle, picontent, pidate, ispibook FROM myissue WHERE email = #{email, jdbcType=VARCHAR} order by pidate desc
</select>
<select id="MyWriteIssueList" resultType="kr.or.scoop.dto.MyIssue">
select piseq,pititle,pidate from myissue where email = #{email}
</select>
<select id="MyWriteTiisueList" resultType="kr.or.scoop.dto.MyIssue">
select t.tseq,t.tititle,t.tidate,t.tiseq, t.isprocess,p.pname from tissue t join teampjt p on t.tseq = p.tseq where t.email = #{email}
</select>
<select id="MyWriteReplyList" resultType="kr.or.scoop.dto.Reply">
select r.replyseq, r.rcontent, r.email, r.rdate, t.tiseq, t.tititle from reply r join tissue t on r.tiseq = t.tiseq where r.email = #{email, jdbcType=VARCHAR}
</select>
<select id="myissueDetail" resultType="kr.or.scoop.dto.MyIssue">
	SELECT piseq, pititle, picontent, pidate, ispibook FROM myissue WHERE piseq = #{piseq, jdbcType=INTEGER}
</select>
<!-- 북마크 -->
<insert id="addPBookMark">
	insert into bookmark(bseq, piseq, email) 
	values(bseq_bookmark_seq.nextval, #{param1}, #{param2})
</insert>
<delete id="delPBookMark">
	delete from bookmark 
	where piseq=#{param1} and email=#{param2}
</delete>
<select id="getBookMark" resultType="kr.or.scoop.dto.BookMark">
	select b.bseq, t.tseq, p.piseq, p.pititle, t.tiseq, t.tititle, b.email, n.name as tiname, m.name as piname
	from bookmark b full outer join myissue p on b.piseq=p.piseq
               	 	full outer join tissue t on b.tiseq=t.tiseq
                	full outer join member m on m.email=p.email
                	full outer join member n on n.email=t.email
	where b.email = #{email}
	order by bseq desc
</select>
<select id="teamWriteTiisueList" resultType="kr.or.scoop.dto.Tissue">
select t.tseq,t.tititle,t.tidate,t.tiseq, t.isprocess,p.pname from tissue t join teampjt p on t.tseq = p.tseq where t.tidate > #{param1, jdbcType=TIMESTAMP} order by t.tidate desc
</select>
<select id="teamWriteReplyList" resultType="kr.or.scoop.dto.Reply">
select r.replyseq, r.rcontent, r.email, r.rdate, t.tiseq, t.tititle from reply r join tissue t on r.tiseq = t.tiseq where r.rdate > #{param1, jdbcType=TIMESTAMP} order by r.rdate desc
</select>
<select id="teamWriteNoticeList" resultType="kr.or.scoop.dto.PjNotice">
select p.pnseq, p.pntitle, p.pncontent, p.pntime, p.email, p.tseq, t.pname, t.email as name from pjnotice p join teampjt t on p.tseq = t.tseq where p.email !=#{param1, jdbcType=VARCHAR} and p.pntime > #{param2, jdbcType=TIMESTAMP} order by p.pntime desc
</select>
<select id="getPjtName" resultType="kr.or.scoop.dto.ProjectName">
	select t.tseq, t.tiseq, p.pname 
	from tissue t join teampjt p on t.tseq=p.tseq 
	where t.tseq = #{param1} and t.tiseq = #{param2}
</select>
</mapper>